jobs:
- job: iOS
  cancelTimeoutInMinutes: 0

  timeoutInMinutes: 90

  pool:
    vmImage: 'macOS-15'

  strategy:
    matrix:
      Cupertino:
        SampleAppName: CupertinoSampleApp
        ProjectPath: src/samples/CupertinoSampleApp
      Material:
        SampleAppName: MaterialSampleApp
        ProjectPath: src/samples/MaterialSampleApp

  variables:
    ArtifactName: ios-$(SampleAppName)

  steps:
  - template: templates/dotnet-install-macos.yml
    parameters:
      UnoCheckParameters: '--tfm net10.0-ios'
  - template: templates/canary-updater.yml
  - template: templates/gitversion.yml

  - bash: |
      echo 'xCode Root to ${XCODE_ROOT}'
      echo '##vso[task.setvariable variable=MD_APPLE_SDK_ROOT;]'${XCODE_ROOT}
      sudo xcode-select --switch ${XCODE_ROOT}/Contents/Developer
    displayName: Select Xcode ($(XCODE_ROOT))

  - bash: |
      cd $(build.sourcesdirectory)/$(ProjectPath)
      dotnet build $(SampleAppName).csproj -f net10.0-ios -c Release /p:TargetFrameworkOverride=ios "/p:InformationalVersion=$(NBGV_InformationalVersion)" "/bl:$(build.artifactstagingdirectory)/themes-build-$(ArtifactName).binlog"
    displayName: Build $(SampleAppName) for Release - (net10.0-ios)

  - task: PublishBuildArtifacts@1
    retryCountOnTaskFailure: 3
    condition: always()
    inputs:
      ArtifactName: $(ArtifactName)
